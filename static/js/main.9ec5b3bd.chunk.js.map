{"version":3,"sources":["components/CurrentTime.tsx","components/StopTimeReport.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["CurrentTime","timer","useRef","useState","time","setTime","useEffect","current","window","setInterval","now","Date","nextTime","Intl","DateTimeFormat","hour","minute","format","split","clearInterval","className","byStopTimeIndexAscending","a","b","index","BusStopHeader","headerData","busStop","dest","StopTimeList","stopTimes","times","filter","sort","slice","length","console","warn","map","item","i","data-row","style","fontSize","x","note","containsOfuna","n","test","SwapDestinationButton","location","search","setDest","nextSearch","onClick","s","SwapIcon","role","App","isLoaded","setLoaded","data","setData","destination","setDestination","getHours","getMinutes","currentIndex","timeIndex","document","toLowerCase","url","queryString","generateUrl","fetch","then","resp","text","JSON","parse","report","header","data-dest","id","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","vh","innerHeight","documentElement","setProperty","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.9ec5b3bd.chunk.js","sourcesContent":["import { FC, useEffect, useRef, useState } from \"react\";\n\nexport const CurrentTime: FC = () => {\n  const timer = useRef(-1);\n  const [time, setTime] = useState<[string, string]>([\"--\", \"--\"]);\n\n  useEffect(() => {\n    timer.current = window.setInterval(() => {\n      const now = new Date();\n      const formatted = Intl.DateTimeFormat(\"ja-JP\", {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      }).format(now);\n      const nextTime = formatted.split(\":\");\n      setTime([nextTime[0], nextTime[1]]);\n    }, 500);\n\n    return () => {\n      window.clearInterval(timer.current);\n    };\n  }, []);\n\n  return (\n    <div className=\"currentTime\">\n      <span>{time[0]}</span>\n      <span className=\"currentTimeColon\">{\":\"}</span>\n      <span>{time[1]}</span>\n    </div>\n  );\n};\n","import { FC, useEffect, useState } from \"react\";\nimport { CurrentTime } from \"./CurrentTime\";\n\ntype StopTime = {\n  index: number;\n  hour: number;\n  minute: number;\n  label: number;\n  note?: string;\n};\n\ntype StopReportHeader = {\n  busStop: string;\n  dest: string;\n  publish: string;\n};\n\nexport type StopReport = {\n  header: StopReportHeader;\n  times: StopTime[];\n};\n\nconst byStopTimeIndexAscending = (a: StopTime, b: StopTime): number =>\n  a.index - b.index;\n\nconst doubleDigitString = (x: number) => `${x < 10 ? \"0\" : \"\"}${x}`;\n\nexport const BusStopHeader: FC<{ headerData: StopReportHeader }> = ({\n  headerData: { busStop, dest },\n}) => {\n  return (\n    <div className=\"header centerAlignedColumn\">\n      <div className=\"stopNameLabel\">{busStop}</div>\n      <div className=\"destinationDisplay\">\n        <div className=\"destinationLabel\">{dest}</div>\n        <SwapDestinationButton />\n      </div>\n      <CurrentTime />\n    </div>\n  );\n};\n\nexport const StopTimeList: FC<{ stopTimes: StopTime[]; index: number }> = ({\n  stopTimes,\n  index,\n}) => {\n  const times = stopTimes\n    .filter((time) => time.index >= index)\n    .sort(byStopTimeIndexAscending)\n    .slice(0, 4);\n  if (times.length < 1) {\n    console.warn(\"no times found\");\n  }\n\n  // const modalMountPoint = document.getElementById(\"modalMountPoint\");\n\n  return (\n    <div className=\"stopTimeList\">\n      {times.map((item, i) => {\n        return (\n          <div\n            key={`${item.index}-${item.note}`}\n            className=\"stopTimeRow\"\n            data-row={i}\n            style={{\n              fontSize: `${4 - i}em`,\n            }}\n          >\n            <div className=\"hour\">{item.hour}</div>\n            <div className=\"colon\">\n              <div>{\":\"}</div>\n            </div>\n            <div className=\"minute\">{doubleDigitString(item.minute)}</div>\n            {item.note && (\n              <div className=\"stopTimeNote\">\n                <div>{`(${item.note})`}</div>\n              </div>\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\ntype Destination = \"totsuka\" | \"ofuna\";\ntype VoidFunc = () => void;\n\nfunction containsOfuna(n: string) {\n  return /ofuna/g.test(n);\n}\n\nconst SwapDestinationButton: FC = () => {\n  const [dest, setDest] = useState<Destination>(() => {\n    const { search } = window.location;\n    return containsOfuna(search) ? \"ofuna\" : \"totsuka\";\n  });\n\n  useEffect(() => {\n    const nextSearch = `?dest=${dest}`;\n    if (window.location.search !== nextSearch) {\n      window.location.search = nextSearch;\n    }\n  }, [dest]);\n\n  const onClick = () => {\n    setDest((s) => (containsOfuna(s) ? \"totsuka\" : \"ofuna\"));\n  };\n\n  return <SwapIcon onClick={onClick} />;\n};\n\nconst SwapIcon: FC<{ onClick?: VoidFunc }> = ({ onClick }) => {\n  return (\n    <div className=\"swapIcon\" role=\"button\" onClick={onClick}>\n      <div className=\"swapArrow top\">→</div>\n      <div className=\"swapArrow bottom\">←</div>\n    </div>\n  );\n};\n","import { useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport { BusStopHeader, StopReport, StopTimeList } from \"./components/StopTimeReport\";\n\n// HACK:  Yeah, I know that it looks like I'm exposing a app secret.\nconst kScriptId = \"AKfycbzhVQD402fi91IlcT9tndtmAvspn2V6noTkh9465JOuUtUcPyoWjhvgkFuQcmC26tPQ3A\";\n\n// TODO: need something more maintainable\ntype Destination = \"totsuka\" | \"ofuna\";\n\nfunction currentIndex(): number {\n  const now = new Date();\n  return (now.getHours() * 60) + now.getMinutes();\n}\n\nfunction getDestination(search: string) {\n  return /ofuna/g.test(search.toLowerCase()) ? \"ofuna\" : \"totsuka\";\n}\n\nfunction generateUrl(dest: Destination, index: number) {\n  const queryString = `?dest=${dest}&index=${index}`;\n  return `https://script.google.com/macros/s/${kScriptId}/exec${queryString}`\n}\n\nfunction App() {\n\n  const [isLoaded, setLoaded] = useState(false);\n  const [data, setData] = useState<StopReport | null>(null);\n  const [destination, setDestination] = useState<Destination>(\"totsuka\");\n  // eslint-disable-next-line\n  const [timeIndex, setTimeIndex] = useState(currentIndex());\n\n  useEffect(() => {\n    if (isLoaded) {\n      return;\n    }\n    const dest = getDestination(document.location.search);\n    setDestination(dest);\n    const url = generateUrl(dest, timeIndex);\n    window\n      .fetch(url)\n      .then((resp) => {\n        return resp.text();\n      })\n      .then(JSON.parse)\n      .then((report: StopReport) => {\n        const { header, times } = report;\n\n        return { header, times };\n      })\n      .then((stopTimes) => {\n        setLoaded(true);\n        setData(stopTimes);\n      });\n  }, [isLoaded, timeIndex]);\n  \n  return (\n    <div className=\"App\" data-dest={destination}>\n      <div className=\"stopTimeReport\">\n      {!isLoaded && <div className=\"loading\">{\"loading...\"}</div>}\n      {data && (\n        <>\n          <BusStopHeader headerData={data.header} />\n          <StopTimeList stopTimes={data.times} index={timeIndex} />\n        </>\n      )}\n      </div>\n      <div id=\"modalMountPoint\" />\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\n// FROM: https://css-tricks.com/the-trick-to-viewport-units-on-mobile/\nlet vh = (window.innerHeight + 20) * 0.01;\ndocument.documentElement.style.setProperty('--vh', `${vh}px`);\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}