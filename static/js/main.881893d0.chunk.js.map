{"version":3,"sources":["components/CurrentTime.tsx","components/StopTimeReport.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["CurrentTime","timer","useRef","useState","time","setTime","useEffect","current","window","setInterval","now","Date","nextTime","Intl","DateTimeFormat","hour","minute","format","split","clearInterval","className","byStopTimeIndexAscending","a","b","index","queryParams","getHours","getMinutes","label","dayofWeek","Error","getTodaysLabel","getDay","BusStopHeader","headerData","busStop","dest","StopTimeList","fullList","params","times","filter","stopTimeQuery","sort","slice","length","console","warn","map","item","i","log","data-row","style","fontSize","note","containsOfuna","n","test","SwapDestinationButton","location","search","setDest","nextSearch","onClick","s","SwapIcon","role","queryString","kUrl","App","isLoaded","setLoaded","data","setData","fetch","then","resp","text","JSON","parse","report","header","stopTimes","toLowerCase","data-dest","id","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","vh","innerHeight","document","documentElement","setProperty","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.881893d0.chunk.js","sourcesContent":["import { FC, useEffect, useRef, useState } from \"react\";\n\nexport const CurrentTime: FC = () => {\n  const timer = useRef(-1);\n  const [time, setTime] = useState<[string, string]>([\"--\", \"--\"]);\n\n  useEffect(() => {\n    timer.current = window.setInterval(() => {\n      const now = new Date();\n      const formatted = Intl.DateTimeFormat(\"ja-JP\", {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      }).format(now);\n      const nextTime = formatted.split(\":\");\n      setTime([nextTime[0], nextTime[1]]);\n    }, 500);\n\n    return () => {\n      window.clearInterval(timer.current);\n    };\n  }, []);\n\n  return (\n    <div className=\"currentTime\">\n      <span>{time[0]}</span>\n      <span className=\"currentTimeColon\">{\":\"}</span>\n      <span>{time[1]}</span>\n    </div>\n  );\n};\n","import { FC, useEffect, useState } from \"react\";\nimport { CurrentTime } from \"./CurrentTime\";\n\ntype StopTime = {\n  index: number;\n  hour: number;\n  minute: number;\n  label: number;\n  note?: string;\n};\n\ntype StopReportHeader = {\n  busStop: string;\n  dest: string;\n  publish: string;\n};\n\nexport type StopReport = {\n  header: StopReportHeader;\n  times: StopTime[];\n};\n\nfunction getTodaysLabel(dayofWeek: number) {\n  if (dayofWeek > 0 && dayofWeek < 6) {\n    return 0;\n  } else if (dayofWeek === 6) {\n    return 1;\n  } else if (dayofWeek === 0) {\n    return 2;\n  } else {\n    throw new Error(\"invalid arg: dayOfWeek must be between 0 ~ 6\");\n  }\n}\n\nconst byStopTimeIndexAscending = (a: StopTime, b: StopTime): number =>\n  a.index - b.index;\n\nconst stopTimeQuery = ({ index, label }: StopTimeQueryParams) => (\n  time: StopTime\n) => {\n  return (\n    time.label === label && time.index > index && time.index <= index + 120\n  );\n};\n\ntype StopTimeQueryParams = {\n  index: number;\n  label: number;\n};\n\nconst queryParams = (): StopTimeQueryParams => {\n  const now = new Date();\n  const index = now.getHours() * 60 + now.getMinutes();\n  const label = getTodaysLabel(now.getDay());\n  // const index = 504;\n  // const label = 0;\n  return { index, label };\n};\n\nexport const BusStopHeader: FC<{ headerData: StopReportHeader }> = ({\n  headerData: { busStop, dest },\n}) => {\n  return (\n    <div className=\"header centerAlignedColumn\">\n      <div className=\"stopNameLabel\">{busStop}</div>\n      <div className=\"destinationDisplay\">\n        <div className=\"destinationLabel\">{dest}</div>\n        <SwapDestinationButton />\n      </div>\n      <CurrentTime />\n    </div>\n  );\n};\n\nexport const StopTimeList: FC<{ fullList: StopTime[] }> = ({ fullList }) => {\n  const params = queryParams();\n\n  const times = fullList\n    .filter(stopTimeQuery(params))\n    .sort(byStopTimeIndexAscending)\n    .slice(0, 4);\n  if (times.length < 1) {\n    console.warn(\"no times found\");\n  }\n\n  // const modalMountPoint = document.getElementById(\"modalMountPoint\");\n\n  return (\n    <div className=\"stopTimeList\">\n      {times.map((item, i) => {\n        console.log(item);\n        return (\n          <div\n            key={`${item.index}-${item.note}`}\n            className=\"stopTimeRow\"\n            data-row={i}\n            style={{\n              fontSize: `${4 - i}em`,\n            }}\n          >\n            <div className=\"hour\">{item.hour}</div>\n            <div className=\"colon\">:</div>\n            <div className=\"minuteAndNote\">\n              <div className=\"minute\">{item.minute}</div>\n              {item.note && (\n                <div className=\"stopTimeNote\">{` (${item.note})`}</div>\n              )}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\ntype Destination = \"totsuka\" | \"ofuna\";\ntype VoidFunc = () => void;\n\nfunction containsOfuna(n: string) {\n  return /ofuna/g.test(n);\n}\n\nconst SwapDestinationButton: FC = () => {\n  const [dest, setDest] = useState<Destination>(() => {\n    const { search } = window.location;\n    return containsOfuna(search) ? \"ofuna\" : \"totsuka\";\n  });\n\n  useEffect(() => {\n    const nextSearch = `?dest=${dest}`;\n    if (window.location.search !== nextSearch) {\n      window.location.search = nextSearch;\n    }\n  }, [dest]);\n\n  const onClick = () => {\n    setDest((s) => (containsOfuna(s) ? \"totsuka\" : \"ofuna\"));\n  };\n\n  return <SwapIcon onClick={onClick} />;\n};\n\nconst SwapIcon: FC<{ onClick?: VoidFunc }> = ({ onClick }) => {\n  return (\n    <div className=\"swapIcon\" role=\"button\" onClick={onClick}>\n      <div className=\"swapArrow top\">→</div>\n      <div className=\"swapArrow bottom\">←</div>\n    </div>\n  );\n};\n","import { useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport { BusStopHeader, StopReport, StopTimeList } from \"./components/StopTimeReport\";\n\nconst { search } = window.location;\nconst queryString = search.length > 0 ? search : \"?dest=Totsuka\";\n\nconst kUrl =\n  \"https://script.google.com/macros/s/\" +\n  \"AKfycbwdm0nmrVJdptlecVeL0VrGfLJz2DyJ65qv-aFcixFtB5-kyJ0rfJLE7yBShRlM0B14tg/exec\" +\n  `${queryString}`;\n\n\nfunction App() {\n\n  const [isLoaded, setLoaded] = useState(false);\n  const [data, setData] = useState<StopReport | null>(null);\n\n  useEffect(() => {\n    if (isLoaded) {\n      return;\n    }\n    window\n      .fetch(kUrl)\n      .then((resp) => {\n        return resp.text();\n      })\n      .then(JSON.parse)\n      .then((report: StopReport) => {\n        const { header, times } = report;\n\n        return { header, times };\n      })\n      .then((stopTimes) => {\n        setLoaded(true);\n        setData(stopTimes);\n      });\n  }, [isLoaded]);\n\n  const [_unused, rawDest] = queryString.split(\"=\");\n  const dest = rawDest.toLowerCase() ?? \"totsuka\";\n  \n  return (\n    <div className=\"App\" data-dest={dest}>\n      <div className=\"stopTimeReport\">\n      {!isLoaded && <div className=\"loading\">{\"loading...\"}</div>}\n      {data && (\n        <>\n          <BusStopHeader headerData={data.header} />\n          <StopTimeList fullList={data.times} />\n        </>\n      )}\n      </div>\n      <div id=\"modalMountPoint\" />\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\n// FROM: https://css-tricks.com/the-trick-to-viewport-units-on-mobile/\nlet vh = (window.innerHeight + 20) * 0.01;\ndocument.documentElement.style.setProperty('--vh', `${vh}px`);\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}