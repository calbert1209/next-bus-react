{"version":3,"sources":["components/CurrentTime.tsx","components/StopTimeReport.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["CurrentTime","timer","useRef","useState","time","setTime","useEffect","current","window","setInterval","now","Date","Intl","DateTimeFormat","hour","minute","format","split","clearInterval","className","byStopTimeIndexAscending","a","b","index","BusStopHeader","headerData","busStop","dest","swapDirection","swapRoute","role","onClick","rotate","colored","StopTimeList","stopTimes","times","filter","sort","slice","length","console","warn","map","item","i","data-row","style","fontSize","x","note","SwapIcon","cNames","push","join","routePoints","start","end","search","getRoutePointsFromUrl","url","params","URL","searchParams","get","App","href","document","location","isLoaded","setLoaded","data","setData","points","setPoints","getHours","getMinutes","currentIndex","timeIndex","nextSearch","queryString","generateUrl","fetch","then","resp","text","JSON","parse","report","header","destination","data-dest","s","nextEnd","id","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","vh","innerHeight","documentElement","setProperty","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.5be19770.chunk.js","sourcesContent":["import { FC, useEffect, useRef, useState } from \"react\";\n\nexport const CurrentTime: FC = () => {\n  const timer = useRef(-1);\n  const [time, setTime] = useState<[string, string]>([\"--\", \"--\"]);\n\n  useEffect(() => {\n    timer.current = window.setInterval(() => {\n      const now = new Date();\n      const formatted = Intl.DateTimeFormat(\"ja-JP\", {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      }).format(now);\n      const [hour, minute] = formatted.split(\":\");\n      setTime([hour, minute]);\n    }, 500);\n\n    return () => {\n      window.clearInterval(timer.current);\n    };\n  }, []);\n\n  return (\n    <div className=\"currentTime\">\n      <span>{time[0]}</span>\n      <span className=\"currentTimeColon\">{\":\"}</span>\n      <span>{time[1]}</span>\n    </div>\n  );\n};\n","import { FC } from \"react\";\nimport { CurrentTime } from \"./CurrentTime\";\n\ntype StopTime = {\n  index: number;\n  hour: number;\n  minute: number;\n  label: number;\n  note?: string;\n};\n\ntype StopReportHeader = {\n  busStop: string;\n  dest: string;\n  publish: string;\n};\n\nexport type StopReport = {\n  header: StopReportHeader;\n  times: StopTime[];\n};\n\nconst byStopTimeIndexAscending = (a: StopTime, b: StopTime): number =>\n  a.index - b.index;\n\nconst doubleDigitString = (x: number) => `${x < 10 ? \"0\" : \"\"}${x}`;\n\nexport const BusStopHeader: FC<{\n  headerData: StopReportHeader;\n  swapDirection: () => void;\n  swapRoute: () => void;\n}> = ({ headerData: { busStop, dest }, swapDirection, swapRoute }) => {\n  return (\n    <div className=\"header centerAlignedColumn\">\n      <div className=\"stopNameLabel\" role=\"button\" onClick={swapRoute}>\n        {busStop}\n      </div>\n      <div className=\"destinationDisplay\">\n        <div className=\"destinationLabel\">{dest}</div>\n        <SwapIcon rotate={true} colored={true} onClick={swapDirection} />\n      </div>\n      <CurrentTime />\n    </div>\n  );\n};\n\nexport const StopTimeList: FC<{ stopTimes: StopTime[]; index: number }> = ({\n  stopTimes,\n  index,\n}) => {\n  const times = stopTimes\n    .filter((time) => time.index >= index)\n    .sort(byStopTimeIndexAscending)\n    .slice(0, 4);\n  if (times.length < 1) {\n    console.warn(\"no times found\");\n  }\n\n  // const modalMountPoint = document.getElementById(\"modalMountPoint\");\n\n  return (\n    <div className=\"stopTimeList\">\n      {times.map((item, i) => {\n        return (\n          <div\n            key={`${item.index}-${item.note}`}\n            className=\"stopTimeRow\"\n            data-row={i}\n            style={{\n              fontSize: `${4 - i}em`,\n            }}\n          >\n            <div className=\"hour\">{item.hour}</div>\n            <div className=\"colon\">\n              <div>{\":\"}</div>\n            </div>\n            <div className=\"minute\">{doubleDigitString(item.minute)}</div>\n            {item.note && (\n              <div className=\"stopTimeNote\">\n                <div>{`(${item.note})`}</div>\n              </div>\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nconst SwapIcon: FC<{\n  rotate?: boolean;\n  colored?: boolean;\n  onClick?: () => void;\n}> = ({ rotate = false, colored = false, onClick }) => {\n  let cNames = [\"swapIcon\"];\n  if (rotate) {\n    cNames.push(\"rotate90\");\n  }\n  if (colored) {\n    cNames.push(\"coloredArrow\");\n  }\n\n  const className = cNames.join(\" \");\n  return (\n    <div className={className} role=\"button\" onClick={onClick}>\n      <div className=\"swapArrow top\">→</div>\n      <div className=\"swapArrow bottom\">←</div>\n    </div>\n  );\n};\n","import { useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport { BusStopHeader, StopReport, StopTimeList } from \"./components/StopTimeReport\";\n\n// HACK:  Yeah, I know that it looks like I'm exposing an app secret.\n// The same script is publicly accessible anyway.\nconst kScriptId = \"AKfycbw3IFf_lsQCWbp6a5ckSYKPWXdLKdCThBU2xytDqjrfX7JJId3_BqALBnDZ_3MWaGBrDQ\";\n\nfunction currentIndex(): number {\n  const now = new Date();\n  return (now.getHours() * 60) + now.getMinutes();\n}\n\nexport type RoutePoints = {\n  start: string;\n  end: string;\n  search: string;\n}\n\nexport function routePoints(start: string, end: string): RoutePoints {\n  return {\n    start,\n    end,\n    search: `?start=${start}&end=${end}`\n  }\n}\n\nexport function getRoutePointsFromUrl(url: string): RoutePoints {\n  const params = new URL(url).searchParams;\n  const start = params.get(\"start\") ?? \"kanai\";\n  const end = params.get(\"end\") ?? params.get(\"dest\") ?? \"totsuka\";\n  return routePoints(start, end);\n}\n\nfunction generateUrl({start, end}: RoutePoints, index: number) {\n  const queryString = `?start=${start}&end=${end}&index=${index}`;\n  return `https://script.google.com/macros/s/${kScriptId}/exec${queryString}`\n}\n\nfunction App() {\n  const { href } = window.document.location;\n  const [isLoaded, setLoaded] = useState(false);\n  const [data, setData] = useState<StopReport | null>(null);\n  const [points, setPoints] = useState<RoutePoints>(() =>\n    getRoutePointsFromUrl(href)\n  );\n  // eslint-disable-next-line\n  const [timeIndex, setTimeIndex] = useState(currentIndex());\n\n  useEffect(() => {\n    setPoints(getRoutePointsFromUrl(href));\n  }, [href]);\n\n  useEffect(() => {\n    const nextSearch = points.search;\n    if (window.location.search !== nextSearch) {\n      window.location.search = nextSearch;\n    }\n  }, [points]);\n\n  useEffect(() => {\n    if (isLoaded) {\n      return;\n    }\n    const points = getRoutePointsFromUrl(document.location.href);\n    setPoints(points);\n    const url = generateUrl(points, timeIndex);\n    window\n      .fetch(url)\n      .then((resp) => {\n        return resp.text();\n      })\n      .then(JSON.parse)\n      .then((report: StopReport) => {\n        const { header, times } = report;\n\n        return { header, times };\n      })\n      .then((stopTimes) => {\n        setLoaded(true);\n        setData(stopTimes);\n      });\n  }, [isLoaded, timeIndex]);\n\n  const swapDirection = () => {\n    setPoints(s => routePoints(s.end, s.start))\n  }\n\n  const swapRoute = () => {\n    setPoints(s => {\n      if (s.start === \"ofuna\") {\n        return routePoints(\"totsuka\", s.end);\n      } else if (s.start === \"totsuka\") {\n        return routePoints(\"ofuna\", s.end);\n      } else {\n        const nextEnd = s.end === \"ofuna\" ? \"totsuka\" : \"ofuna\";\n        return routePoints(s.start, nextEnd);\n      }\n    });\n  }\n\n  const {start, end} = points;\n  const destination = (start === \"ofuna\" || end === \"ofuna\") ? \"ofuna\" : \"totsuka\";\n  return (\n    <div className=\"App\" data-dest={destination}>\n      <div className=\"stopTimeReport\">\n      {!isLoaded && <div className=\"loading\">{\"loading...\"}</div>}\n      {data && (\n        <>\n          <BusStopHeader headerData={data.header} swapDirection={swapDirection} swapRoute={swapRoute} />\n          <StopTimeList stopTimes={data.times} index={timeIndex} />\n        </>\n      )}\n      </div>\n      <div id=\"modalMountPoint\" />\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\n// FROM: https://css-tricks.com/the-trick-to-viewport-units-on-mobile/\nlet vh = (window.innerHeight + 20) * 0.01;\ndocument.documentElement.style.setProperty('--vh', `${vh}px`);\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}